<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task Manager</title>
  <style>
    /* Reset and base */
    * {
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      max-width: 700px;
      margin-left: auto;
      margin-right: auto;
      transition: background-color 0.3s, color 0.3s;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: var(--primary-color);
    }

    /* Light mode variables */
    body.light {
      --bg-color: #f4f7f8;
      --text-color: #333;
      --primary-color: #2c3e50;
      --card-bg: white;
      --input-bg: white;
      --input-border: #ddd;
      --btn-bg: #27ae60;
      --btn-hover-bg: #219150;
      --status-bg: #3498db;
      --edit-btn-bg: #f39c12;
      --delete-btn-bg: #e74c3c;
      --shadow: 0 2px 5px #ccc;
    }
    /* Dark mode variables */
    body.dark {
      --bg-color: #121212;
      --text-color: #ddd;
      --primary-color: #66fcf1;
      --card-bg: #1e1e1e;
      --input-bg: #2c2c2c;
      --input-border: #444;
      --btn-bg: #45a049;
      --btn-hover-bg: #37843c;
      --status-bg: #2980b9;
      --edit-btn-bg: #d35400;
      --delete-btn-bg: #c0392b;
      --shadow: 0 2px 8px #000;
    }

    form {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    input[type="text"], select {
      width: 100%;
      padding: 12px;
      margin: 10px 0 20px 0;
      border: 1.5px solid var(--input-border);
      border-radius: 6px;
      font-size: 16px;
      background-color: var(--input-bg);
      color: var(--text-color);
      transition: background-color 0.3s, border-color 0.3s;
    }
    input[type="text"]:focus, select:focus {
      border-color: var(--btn-bg);
      outline: none;
    }
    button {
      background-color: var(--btn-bg);
      color: white;
      border: none;
      padding: 14px 22px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: var(--btn-hover-bg);
    }

    .tasks {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    .task {
      padding: 15px;
      border-bottom: 1px solid var(--input-border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.2s;
    }
    .task:last-child {
      border-bottom: none;
    }
    .task:hover {
      background-color: var(--input-border);
    }
    .task-info {
      max-width: 70%;
    }
    .task-title {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 6px;
      color: var(--primary-color);
    }
    .task-desc {
      font-size: 15px;
      color: var(--text-color);
    }
    .task-status {
      font-size: 13px;
      padding: 6px 12px;
      border-radius: 16px;
      color: white;
      background-color: var(--status-bg);
      font-weight: 600;
      user-select: none;
      margin-top: 5px;
      display: inline-block;
    }
    .task-actions button {
      padding: 10px 16px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      margin-left: 10px;
      transition: opacity 0.2s;
      color: white;
    }
    .task-actions button.edit-btn {
      background: var(--edit-btn-bg);
    }
    .task-actions button.delete-btn {
      background: var(--delete-btn-bg);
    }
    .task-actions button:hover {
      opacity: 0.85;
    }

    #message {
      text-align: center;
      margin-bottom: 20px;
      font-weight: 700;
      font-size: 16px;
      min-height: 24px;
    }

    /* Dark/Light toggle button */
    #toggle-theme {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--btn-bg);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: background-color 0.3s;
      font-weight: 700;
      z-index: 100;
    }
    #toggle-theme:hover {
      background-color: var(--btn-hover-bg);
    }
    /* @media (max-width: 480px) {
  body {
    padding: 10px;
  } */

  @media (max-width: 480px) {
  body {
    padding: 10px;
  }

  #toggle-theme {
    top: 60px;  /* move down from 20px to 60px */
    right: 15px;
    padding: 8px 14px;
    font-size: 14px;
  }

  h1 {
    margin-bottom: 15px; /* add space below heading */
  }
}

/*   
  h1 {
    font-size: 24px;
  } */
  
  form, .tasks {
    padding: 15px;
  }
  
  input[type="text"], select, #search-input {
    font-size: 14px;
    padding: 10px;
  }
  
  button {
    padding: 12px 18px;
    font-size: 14px;
  }
  
  .task {
    flex-direction: column;
    align-items: flex-start;
    padding: 12px;
  }
  
  .task-info {
    max-width: 100%;
    margin-bottom: 10px;
  }
  
  .task-title {
    font-size: 18px;
  }
  
  .task-desc {
    font-size: 14px;
  }
  
  .task-status {
    font-size: 12px;
    padding: 5px 10px;
  }
  
  .task-actions {
    width: 100%;
    display: flex;
    justify-content: flex-start;
    gap: 10px;
  }
  
  .task-actions button {
    flex: 1;
    padding: 10px 0;
    font-size: 14px;
  }
  
  #toggle-theme {
    top: 10px;
    right: 10px;
    padding: 8px 14px;
    font-size: 14px;
  }

 
 #registerBtn {
  position: fixed;   /* fixed so it stays on top */
  top: 10px;
  left: 10px;
  padding: 7px 18px;
  background-color: #007BFF;
  color: white;
  border: none;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 600;
  z-index: 1000; /* keep it above other elements */
}

#registerBtn:hover {
  background-color: #0056b3;
}




  </style>
</head>
<body class="light">



  <button id="toggle-theme">Dark Mode</button>

  <h1>Task Manager</h1>


  <div id="message"></div>

  <form id="task-form" autocomplete="off">
    <input type="hidden" id="task-id" />
    <input type="text" id="title" placeholder="Task Title" required />
    <input type="text" id="description" placeholder="Task Description" required />
    <select id="status" required>
      <option value="" disabled selected>Select Status</option>
      <option value="Pending">Pending</option>
      <option value="In Progress">In Progress</option>
      <option value="Completed">Completed</option>
    </select>
    <button type="submit">Add Task</button>
  </form>

  <!-- Add this inside <body>, just above <div class="tasks" id="tasks-container"></div> -->

<input 
  type="text" 
  id="search-input" 
  placeholder="Search tasks..." 
  style="width: 100%; padding: 12px; margin-bottom: 20px; border-radius: 6px; border: 1.5px solid var(--input-border); background-color: var(--input-bg); color: var(--text-color); transition: background-color 0.3s, border-color 0.3s;"
/>


  <div class="tasks" id="tasks-container"></div>

<script>


  const apiUrl = 'https://taskmanager-backend-9f8g.onrender.com/tasks';

  const form = document.getElementById('task-form');
  const messageDiv = document.getElementById('message');
  const tasksContainer = document.getElementById('tasks-container');
  const toggleBtn = document.getElementById('toggle-theme');
  const body = document.body;

  function showMessage(text, isError = false) {
    messageDiv.textContent = text;
    messageDiv.style.color = isError ? 'tomato' : 'limegreen';
    setTimeout(() => {
      messageDiv.textContent = '';
    }, 3000);
  }

  // Load tasks from API
  function loadTasks() {
    fetch(apiUrl)
      .then(res => res.json())
      .then(tasks => {
        tasksContainer.innerHTML = '';
        tasks.forEach(task => {
          const taskDiv = document.createElement('div');
          taskDiv.classList.add('task');

          taskDiv.innerHTML = `
            <div class="task-info">
              <div class="task-title">${task.title}</div>
              <div class="task-desc">${task.description}</div>
              <div class="task-status">${task.status}</div>
            </div>
            <div class="task-actions">
              <button class="edit-btn" onclick="editTask(${task.id})">Edit</button>
              <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
            </div>
          `;

          tasksContainer.appendChild(taskDiv);
        });
      })
      .catch(() => showMessage('Failed to load tasks', true));
  }

  // Add or update task
  form.addEventListener('submit', (e) => {
    e.preventDefault();

    const id = document.getElementById('task-id').value;
    const title = document.getElementById('title').value.trim();
    const description = document.getElementById('description').value.trim();
    const status = document.getElementById('status').value;

    const taskData = { title, description, status };

    if (id) {
      // update
      fetch(`${apiUrl}/${id}`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(taskData),
      })
        .then(res => {
          if (!res.ok) throw new Error('Update failed');
          return res.json();
        })
        .then(() => {
          showMessage('Task updated successfully');
          form.reset();
          document.getElementById('task-id').value = '';
          form.querySelector('button').textContent = 'Add Task';
          loadTasks();
        })
        .catch(() => showMessage('Failed to update task', true));
    } else {
      // add
      fetch(apiUrl, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(taskData),
      })
        .then(res => {
          if (!res.ok) throw new Error('Add failed');
          return res.json();
        })
        .then(() => {
          showMessage('Task added successfully');
          form.reset();
          loadTasks();
        })
        .catch(() => showMessage('Failed to add task', true));
    }
  });

  // Edit task
  function editTask(id) {
    fetch(`${apiUrl}/${id}`)
      .then(res => res.json())
      .then(task => {
        document.getElementById('task-id').value = task.id;
        document.getElementById('title').value = task.title;
        document.getElementById('description').value = task.description;
        document.getElementById('status').value = task.status;
        form.querySelector('button').textContent = 'Update Task';
      })
      .catch(() => showMessage('Failed to fetch task details', true));
  }

  // Delete task
  function deleteTask(id) {
    if (!confirm('Are you sure you want to delete this task?')) return;
    fetch(`${apiUrl}/${id}`, {
      method: 'DELETE',
    })
      .then(res => {
        if (!res.ok) throw new Error('Delete failed');
        showMessage('Task deleted successfully');
        loadTasks();
      })
      .catch(() => showMessage('Failed to delete task', true));
  }

  // Dark/light mode toggle logic
  function setTheme(theme) {
    body.className = theme;
    toggleBtn.textContent = theme === 'dark' ? 'Light Mode' : 'Dark Mode';
    localStorage.setItem('theme', theme);
  }
  toggleBtn.addEventListener('click', () => {
    const current = body.className === 'dark' ? 'light' : 'dark';
    setTheme(current);
  });

  // On load, set theme from localStorage or default light
  const savedTheme = localStorage.getItem('theme') || 'light';
  setTheme(savedTheme);

  loadTasks();

  const searchInput = document.getElementById('search-input');
let searchTimeout = null;

searchInput.addEventListener('input', () => {
  clearTimeout(searchTimeout);

  searchTimeout = setTimeout(() => {
    const keyword = searchInput.value.trim();
    if (keyword === '') {
      // If search is empty, load all tasks
      loadTasks();
      return;
    }

    // Call search API
    fetch(`${apiUrl}/search?keyword=${encodeURIComponent(keyword)}`)
      .then(res => {
        if (!res.ok) throw new Error('Search failed');
        return res.json();
      })
      .then(tasks => {
        tasksContainer.innerHTML = '';
        if (tasks.length === 0) {
          tasksContainer.innerHTML = '<p>No tasks found.</p>';
          return;
        }
        tasks.forEach(task => {
          const taskDiv = document.createElement('div');
          taskDiv.classList.add('task');

          taskDiv.innerHTML = `
            <div class="task-info">
              <div class="task-title">${task.title}</div>
              <div class="task-desc">${task.description}</div>
              <div class="task-status">${task.status}</div>
            </div>
            <div class="task-actions">
              <button class="edit-btn" onclick="editTask(${task.id})">Edit</button>
              <button class="delete-btn" onclick="deleteTask(${task.id})">Delete</button>
            </div>
          `;
          tasksContainer.appendChild(taskDiv);
        });
      })
      .catch(() => showMessage('Failed to search tasks', true));
  }, 300); // debounce 300ms
});





</script>





</body>
</html>
